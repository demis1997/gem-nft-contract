<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for L1/Mock/proxy/RefactorCoinageSnapshot.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../prettify.css" />
    <link rel="stylesheet" href="../../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../../index.html">all files</a> / <a href="index.html">L1/Mock/proxy/</a> RefactorCoinageSnapshot.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/98</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/42</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/33</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/112</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.4;
&nbsp;
import { IRefactor } from "../interfaces/IRefactor.sol";
import { AutoRefactorCoinageI } from "../interfaces/AutoRefactorCoinageI.sol";
import { DSMath } from "../libraries/DSMath.sol";
import "../libraries/SArrays.sol";
&nbsp;
import "../../../proxy/ProxyStorage.sol";
import { AuthControlCoinage } from "../common/AuthControlCoinage.sol";
import { RefactorCoinageSnapshotStorage } from "./RefactorCoinageSnapshotStorage.sol";
&nbsp;
&nbsp;
interface IIISeigManager {
  function progressSnapshotId() external view returns (uint256);
}
/**
 * @dev Implementation of coin age token based on ERC20 of openzeppelin/-solidity
 *
 * AutoRefactorCoinage stores `_totalSupply` and `_balances` as RAY BASED value,
 * `_allowances` as RAY FACTORED value.
 *
 * This takes public function (including _approve) parameters as RAY FACTORED value
 * and internal function (including approve) parameters as RAY BASED value, and emits event in RAY FACTORED value.
 *
 * `RAY BASED` = `RAY FACTORED`  / factor
 *
 *  factor increases exponentially for each block mined.
 */
contract RefactorCoinageSnapshot is ProxyStorage, AuthControlCoinage, RefactorCoinageSnapshotStorage, DSMath {
    using SArrays for uint256[];
&nbsp;
    event FactorSet(uint256 previous, uint256 current, uint256 shiftCount);
    event Transfer(address indexed from, address indexed to, uint256 value);
    event ChangedBalance(address indexed account, IRefactor.Balance oldBalance, IRefactor.Balance newBalance, IRefactor.Balance oldTotalBalance, IRefactor.Balance newTotalBalance);
    event ChangedFactor(IRefactor.Factor previous, IRefactor.Factor next);
    // event Snapshotted(uint256 id);
&nbsp;
<span class="fstat-no" title="function not covered" >    function initialize (</span>
      string memory name_,
      string memory symbol_,
      uint256 factor_,
      address seigManager_
    ) external {
&nbsp;
<span class="cstat-no" title="statement not covered" >      require(factorSnapshots[0].factor == 0, "already initialized")</span>;
&nbsp;
      name = name_;
      symbol = symbol_;
      factorSnapshots[0] = IRefactor.Factor(factor_, 0);
      seigManager = seigManager_;
    }
&nbsp;
&nbsp;
    /**
     *  onlyOwner
     **/
&nbsp;
<span class="fstat-no" title="function not covered" >    function setFactor(uint256 factor_) external returns (bool) {</span>
<span class="cstat-no" title="statement not covered" >      IRefactor.Factor memory previous = _valueAtFactorLast();</span>
      // uint256 previous = _factor;
&nbsp;
<span class="cstat-no" title="statement not covered" >      uint256 count = 0;</span>
<span class="cstat-no" title="statement not covered" >      uint256 f = factor_;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      for (; f &gt;= REFACTOR_BOUNDARY; f = f / REFACTOR_DIVIDER) {</span>
        count++;
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      IRefactor.Factor memory nextFactor = IRefactor.Factor(f, count);</span>
<span class="cstat-no" title="statement not covered" >      _updateFactor(nextFactor)</span>;
&nbsp;
&nbsp;
<span class="cstat-no" title="statement not covered" >      emit ChangedFactor(previous, nextFactor);</span>
<span class="cstat-no" title="statement not covered" >      return true;</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function setSeigManager(address _seigManager) external {</span>
      seigManager = _seigManager;
    }
&nbsp;
    /**
     *  onlyMinter
     **/
&nbsp;
<span class="fstat-no" title="function not covered" >    function mint(address account, uint256 amount) public returns (bool) {</span>
<span class="cstat-no" title="statement not covered" >          _mint(account, amount)</span>;
<span class="cstat-no" title="statement not covered" >          return true;</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function burnFrom(address account, uint256 amount) public {</span>
<span class="cstat-no" title="statement not covered" >        _burn(account, amount)</span>;
    }
&nbsp;
    // -------- external
&nbsp;
<span class="fstat-no" title="function not covered" >    function burn(uint256 amount) external {</span>
<span class="cstat-no" title="statement not covered" >        _burn(msg.sender, amount)</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function decimals() external pure returns (uint8) {</span>
<span class="cstat-no" title="statement not covered" >        return 27;</span>
    }
&nbsp;
    // -------- public
&nbsp;
<span class="fstat-no" title="function not covered" >    function factor() public view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >      IRefactor.Factor memory _factor = _valueAtFactorLast();</span>
<span class="cstat-no" title="statement not covered" >      return _factor.factor * REFACTOR_DIVIDER ** _factor.refactorCount;</span>
    }
&nbsp;
    // -------- internal
&nbsp;
<span class="fstat-no" title="function not covered" >    function _mint(address account, uint256 amount) internal {</span>
<span class="cstat-no" title="statement not covered" >      require(account != address(0), "AutoRefactorCoinage: mint to the zero address")</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >      IRefactor.Factor memory f = _valueAtFactorLast();</span>
<span class="cstat-no" title="statement not covered" >      IRefactor.Balance memory _totalBalance = _valueAtTotalSupplyLast();</span>
<span class="cstat-no" title="statement not covered" >      IRefactor.Balance memory _accountBalance = _valueAtAccountBalanceLast(account);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      uint256 currentAccountBalance = applyFactor(_accountBalance);</span>
<span class="cstat-no" title="statement not covered" >      uint256 currentTotalBalance = applyFactor(_totalBalance);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      uint256 rbAmountAccount = _toRAYBased(currentAccountBalance + amount);</span>
<span class="cstat-no" title="statement not covered" >      uint256 rbAmountTotal = _toRAYBased(currentTotalBalance + amount);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      IRefactor.Balance memory newAccountBalance = IRefactor.Balance(rbAmountAccount, f.refactorCount);</span>
<span class="cstat-no" title="statement not covered" >      IRefactor.Balance memory newTotalBalance = IRefactor.Balance(rbAmountTotal, f.refactorCount);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      _update(newAccountBalance, newTotalBalance, account, true, true)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >      emit ChangedBalance(account, _accountBalance, newAccountBalance, _totalBalance, newTotalBalance);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      emit Transfer(address(0), account, amount);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function _burn(address account, uint256 amount) internal {</span>
<span class="cstat-no" title="statement not covered" >      require(account != address(0), "AutoRefactorCoinage: burn from the zero address")</span>;
<span class="cstat-no" title="statement not covered" >      IRefactor.Factor memory f = _valueAtFactorLast();</span>
<span class="cstat-no" title="statement not covered" >      IRefactor.Balance memory _totalBalance = _valueAtTotalSupplyLast();</span>
<span class="cstat-no" title="statement not covered" >      IRefactor.Balance memory _accountBalance = _valueAtAccountBalanceLast(account);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      uint256 currentTotalBalance = applyFactor(_totalBalance);</span>
<span class="cstat-no" title="statement not covered" >      uint256 currentAccountBalance = applyFactor(_accountBalance);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      require(currentAccountBalance &gt;= amount</span>
        &amp;&amp; currentTotalBalance &gt;= amount, "insufficient balance");
&nbsp;
<span class="cstat-no" title="statement not covered" >      uint256 rbAmountTotal = _toRAYBased(currentTotalBalance - amount);</span>
<span class="cstat-no" title="statement not covered" >      uint256 rbAmountAccount = _toRAYBased(currentAccountBalance - amount);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      IRefactor.Balance memory newTotalBalance = IRefactor.Balance(rbAmountTotal, f.refactorCount);</span>
<span class="cstat-no" title="statement not covered" >      IRefactor.Balance memory newAccountBalance = IRefactor.Balance(rbAmountAccount, f.refactorCount);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      _update(newAccountBalance, newTotalBalance, account, true, true)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >      emit ChangedBalance(account, _accountBalance, newAccountBalance, _totalBalance, newTotalBalance);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      emit Transfer(account, address(0), amount);</span>
    }
&nbsp;
    /**
     * @param v the value to be factored
     */
<span class="fstat-no" title="function not covered" >    function _applyFactor(uint256 v, uint256 refactoredCount) internal view returns (uint256) {</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      if (v == 0) {</span>
<span class="cstat-no" title="statement not covered" >        return 0;</span>
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      IRefactor.Factor memory _factor = _valueAtFactorLast();</span>
&nbsp;
      v = rmul2(v, _factor.factor);
&nbsp;
<span class="cstat-no" title="statement not covered" >      if (_factor.refactorCount &gt; refactoredCount) {</span>
        v = v * REFACTOR_DIVIDER ** (_factor.refactorCount - refactoredCount);
      }
<span class="cstat-no" title="statement not covered" >      return v;</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function _applyFactorAt(IRefactor.Balance memory _balance, IRefactor.Factor memory _factor) internal pure returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >      if (_balance.balance == 0) {</span>
<span class="cstat-no" title="statement not covered" >        return 0;</span>
      }
      _balance.balance = rmul2(_balance.balance, _factor.factor);
<span class="cstat-no" title="statement not covered" >      if(_factor.refactorCount &gt; _balance.refactoredCount) {</span>
        _balance.balance = _balance.balance * REFACTOR_DIVIDER ** (_factor.refactorCount - _balance.refactoredCount);
      }
<span class="cstat-no" title="statement not covered" >      return _balance.balance;</span>
    }
&nbsp;
    /**
     * @dev Calculate RAY BASED from RAY FACTORED
     */
<span class="fstat-no" title="function not covered" >    function _toRAYBased(uint256 rf) internal view returns (uint256 rb) {</span>
<span class="cstat-no" title="statement not covered" >      return rdiv2(rf, (_valueAtFactorLast()).factor);</span>
    }
&nbsp;
    /**
     * @dev Calculate RAY FACTORED from RAY BASED
     */
<span class="fstat-no" title="function not covered" >    function _toRAYFactored(uint256 rb) internal view returns (uint256 rf) {</span>
<span class="cstat-no" title="statement not covered" >      return rmul2(rb, (_valueAtFactorLast()).factor);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function _lastSnapshotId(uint256[] storage ids) internal view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return (ids.length == 0? 0: ids[ids.length - 1]);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function _updateFactor(IRefactor.Factor memory _factor) internal {</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      uint256 currentId = progressSnapshotId();</span>
<span class="cstat-no" title="statement not covered" >      uint256 factorIndex = _lastSnapshotId(factorSnapshotIds);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      if (factorIndex &lt; currentId) <span class="cstat-no" title="statement not covered" >factorSnapshotIds.push(currentId)</span>;</span>
      factorSnapshots[currentId] = _factor;
&nbsp;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function _update(</span>
      IRefactor.Balance memory _accountBalance,
      IRefactor.Balance memory _totalBalance,
      address account,
      bool accountBool,
      bool totalBool
    ) internal  {
&nbsp;
<span class="cstat-no" title="statement not covered" >      uint256 currentId = progressSnapshotId();</span>
<span class="cstat-no" title="statement not covered" >      uint256 balanceIndex = _lastSnapshotId(accountBalanceIds[account]);</span>
<span class="cstat-no" title="statement not covered" >      uint256 totalIndex = _lastSnapshotId(totalSupplySnapshotIds);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      if (accountBool) {</span>
<span class="cstat-no" title="statement not covered" >        require(account != address(0), "zero account")</span>;
<span class="cstat-no" title="statement not covered" >        if (balanceIndex &lt; currentId) <span class="cstat-no" title="statement not covered" >accountBalanceIds[account].push(currentId)</span>;</span>
        accountBalanceSnapshots[account][currentId] = _accountBalance;
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      if (totalBool) {</span>
<span class="cstat-no" title="statement not covered" >        if (totalIndex &lt; currentId) <span class="cstat-no" title="statement not covered" >totalSupplySnapshotIds.push(currentId)</span>;</span>
        totalSupplySnapshots[currentId] = _totalBalance;
      }
&nbsp;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function progressSnapshotId() public view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return IIISeigManager(seigManager).progressSnapshotId();</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function applyFactor(IRefactor.Balance memory _balance) public view returns (uint256 amount) {</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      return _applyFactor(_balance.balance, _balance.refactoredCount);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function totalSupply() external view returns (uint256 amount)</span>
    {
      amount = applyFactor(_valueAtTotalSupplyLast());
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function balanceOf(address account) external view returns (uint256 amount)</span>
    {
      amount = applyFactor(_valueAtAccountBalanceLast(account));
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function totalSupplyAt(uint256 snapshotId) external view returns (uint256 amount)</span>
    {
<span class="cstat-no" title="statement not covered" >      (IRefactor.Balance memory _balance,  IRefactor.Factor memory _factor) = getTotalAndFactorAt(snapshotId);</span>
      amount = _applyFactorAt(_balance, _factor);
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function balanceOfAt(address account, uint256 snapshotId) external view</span>
      returns (uint256 amount)
    {
<span class="cstat-no" title="statement not covered" >      (IRefactor.Balance memory _balance,  IRefactor.Factor memory _factor) = getBalanceAndFactorAt(account, snapshotId);</span>
      amount = _applyFactorAt(_balance, _factor);
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getTotalAndFactor() public view returns (IRefactor.Balance memory, IRefactor.Factor memory)</span>
    {
<span class="cstat-no" title="statement not covered" >      return (_valueAtTotalSupplyLast(), _valueAtFactorLast());</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getBalanceAndFactor(address account) public view returns (IRefactor.Balance memory, IRefactor.Factor memory)</span>
    {
<span class="cstat-no" title="statement not covered" >      return (_valueAtAccountBalanceLast(account), _valueAtFactorLast());</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getTotalAndFactorAt(uint256 snapshotId) public view returns (IRefactor.Balance memory, IRefactor.Factor memory)</span>
    {
<span class="cstat-no" title="statement not covered" >      return (_valueAtTotalSupply(snapshotId), _valueAtFactor(snapshotId));</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getBalanceAndFactorAt(address account, uint256 snapshotId) public view returns (IRefactor.Balance memory, IRefactor.Factor memory)</span>
    {
<span class="cstat-no" title="statement not covered" >      return (_valueAtAccount(snapshotId, account), _valueAtFactor(snapshotId));</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function _valueAtTotalSupplyLast() internal view</span>
      returns (IRefactor.Balance memory)
    {
<span class="cstat-no" title="statement not covered" >      uint256 index = 0;</span>
<span class="cstat-no" title="statement not covered" >      uint256 length = totalSupplySnapshotIds.length;</span>
<span class="cstat-no" title="statement not covered" >      if(length != 0) index = totalSupplySnapshotIds[length - 1];</span>
<span class="cstat-no" title="statement not covered" >      return totalSupplySnapshots[index];</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function _valueAtFactorLast() internal view</span>
      returns (IRefactor.Factor memory)
    {
<span class="cstat-no" title="statement not covered" >      uint256 index = 0;</span>
<span class="cstat-no" title="statement not covered" >      uint256 length = factorSnapshotIds.length;</span>
<span class="cstat-no" title="statement not covered" >      if(length != 0) index = factorSnapshotIds[length - 1];</span>
<span class="cstat-no" title="statement not covered" >      return factorSnapshots[index];</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function _valueAtAccountBalanceLast(address account) internal view</span>
      returns (IRefactor.Balance memory)
    {
<span class="cstat-no" title="statement not covered" >      uint256 index = 0;</span>
<span class="cstat-no" title="statement not covered" >      uint256 length = accountBalanceIds[account].length;</span>
<span class="cstat-no" title="statement not covered" >      if(length != 0) index = accountBalanceIds[account][length - 1];</span>
<span class="cstat-no" title="statement not covered" >      return accountBalanceSnapshots[account][index];</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function _valueAtTotalSupply(uint256 snapshotId) internal view</span>
      returns (IRefactor.Balance memory balance)
    {
<span class="cstat-no" title="statement not covered" >      require(snapshotId &lt;= progressSnapshotId(), "snapshotId &gt; progressSnapshotId")</span>;
<span class="cstat-no" title="statement not covered" >      uint256 index = totalSupplySnapshotIds.findValue(snapshotId);</span>
<span class="cstat-no" title="statement not covered" >      return totalSupplySnapshots[index];</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function _valueAtFactor(uint256 snapshotId) internal view</span>
      returns (IRefactor.Factor memory factor_)
    {
<span class="cstat-no" title="statement not covered" >      require(snapshotId &lt;= progressSnapshotId(), "snapshotId &gt; progressSnapshotId")</span>;
<span class="cstat-no" title="statement not covered" >      uint256 index = factorSnapshotIds.findValue(snapshotId);</span>
<span class="cstat-no" title="statement not covered" >      return factorSnapshots[index];</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function _valueAtAccount(uint256 snapshotId, address account) internal view</span>
        returns (IRefactor.Balance memory balance)
    {
<span class="cstat-no" title="statement not covered" >      require(snapshotId &lt;= progressSnapshotId(), "snapshotId &gt; progressSnapshotId")</span>;
<span class="cstat-no" title="statement not covered" >      uint256 index = accountBalanceIds[account].findValue(snapshotId);</span>
<span class="cstat-no" title="statement not covered" >      return accountBalanceSnapshots[account][index];</span>
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri Oct 11 2024 15:51:23 GMT+0200 (Central European Summer Time)
</div>
</div>
<script src="../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../sorter.js"></script>
</body>
</html>
